%
% Copyright (c) 2013 Philip Paeps
%
% Voodoo for typesetting pretty tables with an overview of a room.
%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{roomoverview}[2013/01/25]
\usepackage{xcolor}
%
\gdef\Flag{0}%			% State 0: Overview not started yet
				% State 1: Start room, print title
				% State 2: Print item
				% State 3: Close overview
%
\newcommand{\error@message}[1]{\errmessage{^^JError: #1^^J^^J}}
\newcommand{\warning@message}[1]{\message{^^JWarning: #1^^J^^J}}
%
\newenvironment{roomoverview}[0]{%
	\ifcase\Flag % 0: not started yet
		%
		\gdef\Flag{1}%
		\begin{table}[!h]%
		\small%
		\begin{tabular*}{\textwidth}{@{}l@{ }l p{0.5\textwidth} p{0.3\textwidth} @{}}%
		%
	\else \error@message{Room overviews cannot be nested}%
	\fi}%
{%
        \ifcase\Flag
            %
            \error@message{You must first begin a room overview}%
            %
	\or
	    %
            \error@message{Zero events in roomoverview}%
	    %
	\or
	    %
	    \hline%
	    \end{tabular*}%
	    \end{table}%
	    %
	\else \error@message{Internal error}%
        \fi%
        \gdef\Flag{0}%
}%
%
\newcommand{\Event}[6]{%
	%
	% #1: Title
	% #2: Subtitle
	% #3: Speaker
	% #4: Day
	% #5: Start time
	% #6: End time
	%
        \ifcase\Flag
		\error@message{Room overview not started yet}%
	\or
		\Event@Title%
		\Event@Line{#1}{#2}{#3}{#4}{#5}{#6}%
	\or

		\Event@Line{#1}{#2}{#3}{#4}{#5}{#6}%
	\else \error@message{Internal error}%
	\fi%
}%
%
\newcommand{\Event@Title}{
	% Internal command.  Called by \Event.
	\multicolumn{2}{@{}l}{\bf Time} & \bf Title & \bf Speaker(s)\\%
	\hline%
}%
%
\newcommand{\Event@Line}[6]{%
	% Internal command. called by \Event.
	\gdef\Flag{2}%
	#4 & #5 -- #6 & #1
	\if\relax\detokenize{#2}\relax\else
		{\small --- #2}
	\fi
	& #3\\%
}%
%
% for main track talks
\newcommand{\Maintrack}[6]{%
	%
	% #1: Title
	% #2: Subtitle
	% #3: Speaker
	% #4: Day
	% #5: Start time
	% #6: End time
	%
    \subsection{#1}
    \if\relax\detokenize{#2}\relax\else
        {\vspace{-1ex}\large #2}\\
    \fi
    {\bf #3} \hspace*{\fill} {\small #4 #5 -- #6}
}%
\newcommand{\Room}[2]{%
	%
	% #1: Track
	% #2: Room
	%
    \bigskip%
    \colorsection{%
    {\Large\bf #1} \hspace*{\fill} {\bf #2}

    }%
}%
\newcommand{\colorsection}[1]{%
  \colorbox{gray!20}{\parbox{\dimexpr\linewidth-2\fboxsep}{#1}}%
}
\newenvironment{trackoverview}[0]{%
    \begin{center}
    \onehalfspacing
    \begin{tabular}{l l}
}%
{%
    \end{tabular}
    \end{center}
}%
\newcommand{\ItemTrack}[2]{%
	%
	% #1: Track
	% #2: ref
	%
    #1 & page~\pageref{#2} \\
}%
\newenvironment{roomoverview_wide}[0]{%
	\ifcase\Flag % 0: not started yet
		%
		\gdef\Flag{1}%
		\begin{table}[!h]%
		\small%
		\begin{tabular*}{\textwidth}{@{}l@{ }l p{0.6\textwidth} p{0.2\textwidth} @{}}%
		%
	\else \error@message{Room overviews cannot be nested}%
	\fi}%
{%
        \ifcase\Flag
            %
            \error@message{You must first begin a room overview}%
            %
	\or
	    %
            \error@message{Zero events in roomoverview}%
	    %
	\or
	    %
	    \hline%
	    \end{tabular*}%
	    \end{table}%
	    %
	\else \error@message{Internal error}%
        \fi%
        \gdef\Flag{0}%
}%
%
